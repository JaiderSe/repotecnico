<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba técnica</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>

<body>

  <div class="container" style="margin-top: 100px;">

    <!-- Export to PDF Button -->
    <div class="mb-3">
      <button id="exportPdfBtn" class="btn btn-primary">Exportar a PDF</button>
    </div>

    <!-- Sessions Table -->
    <table class="table table-striped table-responsive" id="sessionsTable">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Docente</th>
          <th scope="col">Estudiante</th>
          <th scope="col">Fecha</th>
          <th scope="col">Hora Inicio</th>
          <th scope="col">Hora Fin</th>
          <th scope="col">Descripción</th>
        </tr>
      </thead>
      <tbody id="sessionsTableBody">
        <!-- Data will be loaded dynamically from localStorage -->
      </tbody>
    </table>
    
  </div>

  <!-- jsPDF Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- jsPDF-AutoTable Plugin -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

  <script>
    // Initialize empty sessions structure if it doesn't exist
    function initializeSessions() {
      if (!localStorage.getItem('sessions')) {
        const emptySessions = {
          sessions: []
        };
        localStorage.setItem('sessions', JSON.stringify(emptySessions));
      }
    }

    // Load sessions from localStorage and populate the table
    function loadSessions() {
      const sessionsData = localStorage.getItem('sessions');
      if (!sessionsData) {
        return;
      }

      const data = JSON.parse(sessionsData);
      const tableBody = document.getElementById('sessionsTableBody');
      tableBody.innerHTML = ''; // Clear existing rows

      if (data.sessions.length === 0) {
        // Show message when no sessions exist
        const emptyRow = document.createElement('tr');
        emptyRow.innerHTML = `
          <td colspan="7" class="text-center text-muted py-4">
            <em>No hay sesiones registradas aún</em>
          </td>
        `;
        tableBody.appendChild(emptyRow);
      } else {
        // Populate table with sessions
        data.sessions.forEach((session, index) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <th scope="row">${index + 1}</th>
            <td>${session.teacherName}</td>
            <td>${session.studentName}</td>
            <td>${session.date}</td>
            <td>${session.startTime}</td>
            <td>${session.endTime}</td>
            <td>${session.description}</td>
          `;
          tableBody.appendChild(row);
        });
      }
    }

    // Export table to PDF
    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Add title
      doc.setFontSize(16);
      doc.text('Asesorías TutorUD', 14, 15);

      // Get sessions data
      const sessionsData = localStorage.getItem('sessions');
      if (!sessionsData) {
        alert('No hay datos para exportar');
        return;
      }

      const data = JSON.parse(sessionsData);

      // Check if there are any sessions
      if (!data.sessions || data.sessions.length === 0) {
        alert('No hay sesiones registradas para exportar');
        return;
      }
      
      // Prepare table data
      const tableData = data.sessions.map((session, index) => [
        index + 1,
        session.teacherName,
        session.studentName,
        session.date,
        session.startTime,
        session.endTime,
        session.description
      ]);

      // Generate PDF table
      doc.autoTable({
        head: [['#', 'Docente', 'Estudiante', 'Fecha', 'Hora Inicio', 'Hora Fin', 'Descripción']],
        body: tableData,
        startY: 25,
        styles: {
          fontSize: 9,
          cellPadding: 3
        },
        headStyles: {
          fillColor: [13, 110, 253], // Bootstrap primary blue
          textColor: 255,
          fontStyle: 'bold'
        },
        columnStyles: {
          0: { cellWidth: 10 },
          1: { cellWidth: 30 },
          2: { cellWidth: 30 },
          3: { cellWidth: 25 },
          4: { cellWidth: 20 },
          5: { cellWidth: 20 },
          6: { cellWidth: 55 }
        }
      });

      // Save the PDF
      doc.save('asesorias_TutorUD.pdf');
    }

    // Initialize data and load sessions on page load
    document.addEventListener('DOMContentLoaded', function() {
      initializeSessions();
      loadSessions();

      // Add event listener to export button
      document.getElementById('exportPdfBtn').addEventListener('click', exportToPDF);
    });
  </script>
  
</body>
</html>
